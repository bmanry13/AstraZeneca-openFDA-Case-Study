---
title: "Inital Data Exploration"
---

```{r, echo=FALSE}
source("./R/functions.R")
```


# High-Level Data Exploration

**NOTE ABOUT USING COUNT RESPONSES EXACT VS. NOT, RELATED IMPLICATIONS, and an examples**

* Top reported events (by SAE classification)

```{r}
qList = list(
  "count" = "patient.reaction.reactionmeddrapt.exact", 
  "limit" = 10)
countPlot(getResults(qList), "Adverse Event Type", "Top-10 Reported Adverse Events FAERS")
```

* Reporter Type
```{r}
qList$count = "primarysource.qualification"
countPlot(getResults(qList), "Reporter Type", "Report Counts by Reporter Type", mapCategories = "primarysource.qualification")
```

* Reporting countries
```{r}
qList$count = "occurcountry.exact"
countPlot(getResults(qList), "Country", "Report Counts by Country of Occurance")
```

```{r}
qList$count = "serious"
mapCategoryValues(getResults(qList), qList$count)
```

### Exploring AE Reporting

*Reporter Type*
```{r}
compareAE = function(count_group, mapCatValues = FALSE, limit = 10){
  qList = list(count = count_group, limit = 1000)
  count_table = getResults(qList)
  # ADD SAE COUNTS
  qList$search = "serious:1"
  count_table = merge(count_table, getResults(qList), by = "term")
  names(count_table)[2:3] = c("total_reports", "SAE")
  count_table$SAE_PCT = count_table$SAE / count_table$total_reports
  # ADD AE COUNTS
  qList$search = "serious:2"
  count_table = merge(count_table, getResults(qList), by = "term")
  names(count_table)[5] = "AE"
  count_table$AE_PCT = count_table$AE / count_table$total_reports
  # JUST CONFIRMING THAT SAE AND AE REPORT COUNTS ARE MUTUALLY EXCLUSIVE
  count_table$net_pct = count_table$AE_PCT + count_table$SAE_PCT
  if(mapCatValues) count_table = mapCategoryValues(count_table, qList$count)
  count_table = count_table[order(-count_table$total_reports), ]
  
  return(count_table[1:min(nrow(count_table), limit), ])
}

compareAE("primarysource.qualification", mapCatValues = TRUE)
```

*Country*
```{r}
compareAE("occurcountry.exact")
```

### Exploring Drug Names Within Reports

* Generic Drug Names Included in Report

**ADD NOTE ABOUT openFDA field harmonization when it comes to drug names**

```{r}
qList$count = "patient.drug.openfda.generic_name.exact"
qList$limit = 20
countPlot(getResults(qList), "Generic Name", "Report Counts by Harmonized Generic Name")
```


```{r}
qList$count = "patient.drug.medicinalproduct"
qList$limit = 20
countPlot(getResults(qList), "Generic Name", "Report Counts by Reported Name")
```


```{r, rows.print=20, row.names = FALSE}
qList$search = "patient.drug.medicinalproduct:METFORMIN"
qList$count = "patient.drug.medicinalproduct.exact"
qList$limit = 1000 #counts are limited to 1000 results
raw_met_count = getResults(qList)
raw_met_count = raw_met_count[grepl("METFORMIN", raw_met_count$term), ]
names(raw_met_count)[2] = "raw_count"
raw_met_count
```

```{r, rows.print=20, row.names = FALSE}
qList$search = "patient.drug.openfda.generic_name:METFORMIN"
qList$count = "patient.drug.medicinalproduct.exact"
qList$limit = 1000
generic_met_count = getResults(qList)
generic_met_count[grepl("METFORMIN", generic_met_count$term), ]
```


```{r}
write(content(GET(createQuery(list(search = 'patient.drug.medicinalproduct:"METFORMIN+(UNKNOWN)"'))), as = "text"), file = "./data/json_extracts/METFORMIN_UNKNOWN_example.json")

```


# Sources

















